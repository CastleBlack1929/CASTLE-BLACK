<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login - Castle Black</title>
  <link rel="stylesheet" href="../css/style-login.css">
</head>
<body>
  <div class="login-container">
    <h1>Castle Black</h1>
    <form id="loginForm" autocomplete="off">
      <input type="text" id="usuario" placeholder="Usuario" required />
      <input type="password" id="contraseña" placeholder="Contraseña" required />
      <div id="mensaje-error" class="mensaje-error"></div>
      <button type="submit">Iniciar sesión</button>
    </form>
  </div>

  <script>
  const usuariosHashed = [
    { u_hash: "8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918", p_hash: "03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4" },
    { u_hash: "5d942a1d73fd8f28d71e6b03d2e42f44721db94b734c2edcfe6fcd48b76a74f9", p_hash: "6ca13d52ca70c883e0f0bb101e425a89e8624de51db2d2392593af6a84118090" },
    { u_hash: "395acd169ca407da8ba4ce63046bbea547468235c2823b28d28a4d66f1bd7bb6", p_hash: "65e84be33532fb784c48129675f9eff3a682b27168c0ea744b2cf58ee02337c5" }
  ];

  function buf2hex(buffer) {
    const bytes = new Uint8Array(buffer);
    return Array.from(bytes).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  async function sha256Hex(message) {
    const enc = new TextEncoder();
    const data = enc.encode(message);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    return buf2hex(hashBuffer);
  }

  async function validarLogin() {
    const inputUsuario = document.getElementById('usuario');
    const inputPass    = document.getElementById('contraseña');
    const mensajeError = document.getElementById('mensaje-error');

    mensajeError.style.display = 'none';
    mensajeError.textContent = '';
    inputUsuario.classList.remove('error');
    inputPass.classList.remove('error');

    const user = inputUsuario.value.trim();
    const pass = inputPass.value;

    if (!user || !pass) {
      mensajeError.textContent = 'Ingresa usuario y contraseña';
      mensajeError.style.display = 'block';
      inputUsuario.classList.add('error');
      inputPass.classList.add('error');
      return;
    }

    const userHash = await sha256Hex(user);
    const passHash = await sha256Hex(pass);

    const found = usuariosHashed.find(u => u.u_hash === userHash && u.p_hash === passHash);

    if (found) {
      inputPass.value = '';
      window.location.href = "../dashboard/dashboard.html";
    } else {
      mensajeError.textContent = "Usuario o contraseña incorrectos";
      mensajeError.style.display = 'block';
      inputUsuario.classList.add('error');
      inputPass.classList.add('error');
      setTimeout(() => { mensajeError.style.display = 'none'; }, 3500);
    }
  }

  document.getElementById('loginForm').addEventListener('submit', (e) => {
    e.preventDefault();
    validarLogin();
  });
  </script>
</body>
</html>
