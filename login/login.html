<!-- login/login.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login - Castle Black</title>
  <link rel="stylesheet" href="../css/style-login.css">
</head>
<body>
  <div class="login-container">
    <h1>Castle Black</h1>
    <form id="loginForm" autocomplete="off">
      <input type="text" id="usuario" placeholder="Usuario" required />
      <input type="password" id="contraseña" placeholder="Contraseña" required />
      <div id="mensaje-error" class="mensaje-error"></div>
      <button type="submit">Iniciar sesión</button>
    </form>
  </div>

  <script>
  const usuariosHashed = [
    { u_hash: "b5e733d9594c3aebcc0624431becf18f0b1c18a6c652c235dba1d33bb15198f5", p_hash: "b5e733d9594c3aebcc0624431becf18f0b1c18a6c652c235dba1d33bb15198f5" }
  ];

  function buf2hex(buffer) {
    const bytes = new Uint8Array(buffer);
    return Array.from(bytes).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  async function sha256Hex(message) {
    const enc = new TextEncoder();
    const data = enc.encode(message);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    return buf2hex(hashBuffer);
  }

  async function validarLogin() {
    const inputUsuario = document.getElementById('usuario');
    const inputPass    = document.getElementById('contraseña');
    const mensajeError = document.getElementById('mensaje-error');

    mensajeError.style.display = 'none';
    mensajeError.textContent = '';
    inputUsuario.classList.remove('error');
    inputPass.classList.remove('error');

    const user = inputUsuario.value.trim();
    const pass = inputPass.value;

    if (!user || !pass) {
      mensajeError.textContent = 'Ingresa usuario y contraseña';
      mensajeError.style.display = 'block';
      inputUsuario.classList.add('error');
      inputPass.classList.add('error');
      return;
    }

    const userHash = await sha256Hex(user);
    const passHash = await sha256Hex(pass);

    const found = usuariosHashed.find(u => u.u_hash === userHash && u.p_hash === passHash);

    if (found) {
      localStorage.setItem('loggedUser', user);
      inputPass.value = '';
      window.location.href = "../dashboard/dashboard.html";
    } else {
      mensajeError.textContent = "Usuario o contraseña incorrectos";
      mensajeError.style.display = 'block';
      inputUsuario.classList.add('error');
      inputPass.classList.add('error');
      setTimeout(() => { mensajeError.style.display = 'none'; }, 3500);
    }
  }

  document.getElementById('loginForm').addEventListener('submit', (e) => {
    e.preventDefault();
    validarLogin();
  });
  </script>
</body>
</html>
